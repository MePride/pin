# Pin 项目架构设计文档

## 项目概述

Pin 是一个基于 ESP32-C3 和 FPC-A005 彩色电子墨水屏的开源数字极简主义设备项目。项目目标是创建一个可定制、低功耗的智能显示设备，支持插件生态系统。

## 项目特点

- **硬件平台**: ESP32-C3 + FPC-A005 (2.9英寸七色电子墨水屏)
- **开发框架**: ESP-IDF + FreeRTOS
- **配置界面**: PWA (Progressive Web App)
- **连接方式**: WiFi + 内置Web服务器
- **扩展能力**: 插件系统支持社区生态

## 整体系统架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        Pin生态系统                               │
├─────────────────────────────────────────────────────────────────┤
│  硬件层 (Hardware)                                              │
│  ┌─────────────────┐    ┌─────────────────┐                     │
│  │   Pin Device    │    │  Pin Hardware   │                     │
│  │  ESP32-C3 +     │◄──►│   Extensions    │                     │
│  │  FPC-A005       │    │  (NFC, Sensors) │                     │
│  └─────────────────┘    └─────────────────┘                     │
├─────────────────────────────────────────────────────────────────┤
│  固件层 (Firmware)                                              │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │             Pin OS (ESP-IDF + FreeRTOS)                     │ │
│  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐            │ │
│  │  │显示管理模块 │ │网络通信模块 │ │电源管理模块 │            │ │
│  │  └─────────────┘ └─────────────┘ └─────────────┘            │ │
│  │  ┌─────────────────────────────────────────────────────────┐ │ │
│  │  │              插件系统 (Widget System)                   │ │ │
│  │  └─────────────────────────────────────────────────────────┘ │ │
│  └─────────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────────┤
│  配置层 (Configuration)                                         │
│  ┌─────────────────┐ ┌─────────────────┐                        │
│  │  Pin PWA 应用   │ │   WiFi 配置     │                        │
│  │   网页配置       │ │    门户服务      │                        │
│  └─────────────────┘ └─────────────────┘                        │
└─────────────────────────────────────────────────────────────────┘
```

## 核心技术栈

### 硬件层
- **主控**: ESP32-C3 (RISC-V, 4MB Flash, 400KB SRAM)
- **显示屏**: FPC-A005 2.9英寸彩色电子墨水屏 (600×448, 7色)
- **通信**: WiFi 802.11 b/g/n, Bluetooth 5.0
- **接口**: SPI (显示), GPIO (按钮/传感器), I2C (扩展)

### 固件层
- **操作系统**: FreeRTOS
- **开发框架**: ESP-IDF v5.x
- **显示驱动**: 自定义 FPC-A005 驱动库
- **网络层**: ESP-WiFi + HTTP Server
- **存储**: NVS (配置) + SPIFFS (资源文件)

### 应用层
- **配置界面**: PWA (HTML5 + CSS3 + JavaScript)
- **插件系统**: C语言插件框架
- **数据格式**: JSON (配置) + 二进制 (显示数据)

## 项目目录结构

```
pin/
├── docs/                   # 项目文档
│   ├── architecture/       # 架构设计文档
│   ├── development/        # 开发指南
│   └── api/               # API参考文档
├── firmware/              # ESP32-C3 固件代码
│   ├── main/              # 主程序
│   ├── components/        # 自定义组件
│   ├── plugins/           # 内置插件
│   └── web/              # PWA 应用
├── hardware/             # 硬件设计文件
│   ├── schematic/        # 原理图
│   ├── pcb/             # PCB设计
│   └── bom/             # 物料清单
└── tools/               # 开发工具
    ├── plugin_builder/  # 插件构建工具
    └── flash_tool/      # 刷机工具
```

## 设计原则

1. **极简主义**: 界面简洁，功能专注，减少干扰
2. **低功耗**: 深度睡眠机制，电池续航数月
3. **可扩展**: 插件系统支持功能扩展
4. **用户友好**: PWA配置，无需安装APP
5. **开源协作**: 完整开源，支持社区贡献

## 技术亮点

- **彩色电子墨水屏**: 七色显示，阳光下可读，超低功耗
- **智能刷新策略**: 三级刷新机制平衡显示质量和功耗
- **插件沙盒**: 安全的插件运行环境，防止系统崩溃
- **PWA配置**: 跨平台配置界面，兼容所有现代浏览器
- **WiFi门户**: 用户友好的网络配置流程

## 开发路线

### Phase 1: 核心功能 (MVP)
- [ ] FPC-A005 显示驱动实现
- [ ] WiFi配置门户
- [ ] 基础PWA界面
- [ ] 时钟插件示例

### Phase 2: 插件系统
- [ ] 插件框架完善
- [ ] 天气、日历插件
- [ ] 插件配置界面
- [ ] 资源管理优化

### Phase 3: 生态建设
- [ ] 插件开发工具
- [ ] 开发文档完善
- [ ] 社区支持准备
- [ ] 硬件优化迭代

## 参考项目

- [E-paper Clock](https://github.com/samunemeth/E-paper-Clock) - ESP32电子墨水屏时钟
- [Dot. Project](https://dot.mindreset.tech/docs) - 数字极简主义设备

## 许可证

本项目采用 MIT 许可证开源。